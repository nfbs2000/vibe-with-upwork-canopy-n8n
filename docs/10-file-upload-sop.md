# 파일 업로드 감지 및 알림 표준 운영 절차 (SOP)

## 1. 개요
Canopy Tax CRM의 Public API는 현재 "파일 업로드 이벤트"를 자동으로 외부로 전송하는 기능(Webhook)을 제공하지 않습니다.
따라서, **Email-to-Webhook** 방식으로 Canopy 알림 이메일을 트리거로 사용하는 절차가 필요합니다. 이 문서에서는 그 구체적인 절차를 정의합니다.

## 2. 필수 설정 (최초 1회)

### 2.1 이메일 알림 켜기
모든 담당자(Tax Preparer)는 본인의 Canopy 계정에서 아래 설정을 켜야 합니다.

1.  Canopy 로그인
2.  **Settings** > **Notifications** 메뉴로 이동
3.  **Client uploads a file** 항목의 **Email** 체크박스 활성화
    *   (선택 사항) 모바일 앱이 있다면 **Mobile Push**도 켜두면 좋습니다.

### 2.2 Gmail 연동
Canopy 알림 메일을 수신하는 Gmail 계정을 n8n에 연결합니다.

### 2.3 (선택) Custom Field
내부 상태 기록이 필요하면 아래 필드를 사용합니다.

*   **Field Name**: `File Upload Status`
*   **Options**: `Pending` (기본값), `Uploaded`, `Review Completed`

## 3. 일일 업무 절차 (Daily Routine)

### 단계 1: 알림 수신 (Trigger)
*   고객이 파일을 업로드하면, 담당자의 메일함으로 **"New File Uploaded"** 제목의 이메일이 도착합니다.

### 단계 2: 검토 및 승인 (선택)
1.  이메일 본문의 **[View Client]** 또는 파일 링크를 클릭하여 Canopy의 해당 고객 프로필로 이동합니다.
2.  업로드된 파일을 간단히 확인합니다 (파일이 맞는지 등).
3.  승인 단계가 필요하면 내부 승인 링크(n8n resume URL)를 클릭합니다.

### 단계 3: 자동화 실행 (Automation)
*   Canopy 알림 메일이 지정된 Gmail로 도착하면, **n8n 자동화 시스템**이 수분 내 감지하여 아래 작업을 수행합니다(승인 단계 포함 시 승인 후 실행).
    1.  **고객 알림**: "서류가 정상적으로 접수되었습니다." (카카오톡 알림톡 발송)
    2.  **내부 기록**: 접수 대장에 기록 (엑셀/구글 시트 등 연동 시)

## 4. 요약
| 주체 | 역할 | 비고 |
| :--- | :--- | :--- |
| **Canopy** | 파일 업로드 시 담당자에게 이메일 발송 | 시스템 자동 |
| **담당자** | 이메일 확인 후 승인(필요 시) | **수동 업무 (필수)** |
| **n8n** | 이메일 파싱 후 알림 발송 | 시스템 자동 |

> **Note**: 이 절차는 Canopy가 추후 공식적인 '파일 업로드 웹훅'을 지원하기 전까지 유효한 임시 표준안입니다.
